<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabaseUrl = "https://vsazstyxjsgrgggxfpal.supabase.co"
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  const supabase = supabase.createClient(supabaseUrl, supabaseKey)

  async function enviarFoto() {
    const fileInput = document.getElementById("upload")
    const file = fileInput.files[0]
    if (!file) return alert("Selecione uma imagem!")

    const nomeArquivo = Date.now() + "-" + file.name

    const { error: uploadError } = await supabase.storage
      .from("fotos")
      .upload(nomeArquivo, file)

    if (uploadError) {
      console.error(uploadError)
      return alert("Erro ao enviar imagem")
    }

    const { data } = supabase.storage.from("fotos").getPublicUrl(nomeArquivo)
    const url = data.publicUrl

    await supabase.from("imagens").insert({ url })

    carregarFotos()
  }

  async function carregarFotos() {
    const { data, error } = await supabase
      .from("imagens")
      .select("*")
      .order("created_at", { ascending: false })

    const galeria = document.getElementById("galeria")
    galeria.innerHTML = ""

    data.forEach(img => {
      const tag = document.createElement("img")
      tag.src = img.url
      tag.style = "max-width: 300px; margin: 10px;"
      galeria.appendChild(tag)
    })
  }

  carregarFotos()
</script>
